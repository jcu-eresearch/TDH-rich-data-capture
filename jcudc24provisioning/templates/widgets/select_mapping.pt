<fieldset class="selectMappingFieldset" i18n:domain="deform">
    <!-- select mapping -->
    <ul>
        <li class="errorLi" tal:condition="field.errormsg">
            <h3 class="errorMsgLbl" i18n:translate="">There was a problem with this section</h3>

            <p class="errorMsg">${field.errormsg}</p>
        </li>

        <li class="section description" tal:condition="field.description">
            <div>${field.description}</div>
        </li>
        <label class="desc" for="${field.oid}">${field.title}<span tal:condition="field.required" class="req"
                                                                   id="req-${field.oid}">*</span>
        </label>
        <span id="select_mapping_options-${field.oid}" style="display: none;"><span tal:repeat="f field.children"
                                                                                    tal:replace="f.oid"/></span>
        <select name="${field.name}" title="${field.description}"
                onchange="setSelectedItem(this)"
                id="${field.oid}"
                tal:attributes="size field.widget.size"
                tal:attributes="class field.widget.css_class">
            <option tal:attributes="class field.widget.css_class" value=" ">---Select One---</option>
            <option tal:repeat="f field.children"
                    tal:attributes="selected f.oid == cstruct and 'selected';
                         class field.widget.css_class"
                    value="${f.oid}">${f.title}
            </option>
        </select>

        <input type="hidden" name="__start__" value="${field.name}:mapping"/>

        <div id="select_mapping_content-${field.oid}">
            <div tal:define="rndr field.renderer; tmpl field.widget.item_template"
                 tal:repeat="f field.children"
                 tal:replace="structure ((f.oid == cstruct) and rndr(tmpl,field=f,cstruct=cstruct.get(f.name,null)) or nothing)">
            </div>
        </div>
        <input type="hidden" name="__end__" value="${field.name}:mapping"/>

        <div id="select_mapping_prototypes-${field.oid}">
            <input type="hidden"
                   tal:define="rndr field.renderer; tmpl field.widget.item_template"
                   tal:repeat="f field.children"
                   tal:attributes="id 'select_item-' + f.oid;
                                  class 'select_mapping_prototype'"
                   value="${rndr(tmpl,field=f,cstruct=cstruct.get(f.name,null))}"/>
        </div>
    </ul>
    <!-- /mapping -->
</fieldset>

<script type="text/javascript">
    function setSelectedItem(select_element) {
        var protos = document.getElementById("select_mapping_prototypes-" + select_element.id).children;

        var i = 0;
        var selectedProto;
        for (i; i < protos.length; i++) {
            if (protos[i].className == "select_mapping_prototype" && protos[i].id.indexOf(select_element.value) >= 0) {
                selectedProto = protos[i];
                break;
            }
        }

        var newHTML = (typeof selectedProto == 'undefined' ? "" : selectedProto.value);
        document.getElementById("select_mapping_content-" + select_element.id).innerHTML = newHTML;
    }
</script>



